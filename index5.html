<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>QR Text Decoder Platform</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- QR Decode Library -->
<script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>

<style>
:root{
  --bg:#f4f6fb;
  --card:#ffffff;
  --primary:#0f172a;
  --accent:#2563eb;
  --muted:#6b7280;
  --border:#e5e7eb;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Segoe UI, Arial, sans-serif;
  background:var(--bg);
  color:var(--primary);
}
header{
  background:var(--primary);
  color:#fff;
  padding:14px 18px;
  font-size:18px;
  font-weight:600;
}
.container{
  max-width:520px;
  margin:20px auto;
  padding:14px;
}
.card{
  background:var(--card);
  border-radius:14px;
  padding:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
  margin-bottom:16px;
}
h2{
  font-size:16px;
  margin:0 0 10px;
}
textarea{
  width:100%;
  min-height:70px;
  border-radius:10px;
  border:1px solid var(--border);
  padding:10px;
  font-size:14px;
}
button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  background:var(--accent);
  color:#fff;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
  margin-top:10px;
}
button.secondary{
  background:#111827;
}
video{
  width:100%;
  border-radius:12px;
  border:1px solid var(--border);
}
.output{
  border:1px dashed var(--border);
  border-radius:12px;
  padding:12px;
  font-size:14px;
}
.row{
  margin-bottom:6px;
}
.label{
  color:var(--muted);
  font-size:12px;
}
.value{
  font-weight:600;
}
.error{
  color:#dc2626;
  font-weight:600;
}
.success{
  color:#16a34a;
  font-weight:600;
}
footer{
  text-align:center;
  font-size:12px;
  color:var(--muted);
  margin-top:10px;
}
</style>
</head>

<body>
<header>QR Text Decoder Platform</header>

<div class="container">

  <!-- CAMERA SCAN -->
  <div class="card">
    <h2>Scan QR (Text Only)</h2>
    <video id="video" autoplay muted playsinline></video>
    <button onclick="startScan()">Start Camera Scan</button>
  </div>

  <!-- MANUAL INPUT -->
  <div class="card">
    <h2>Paste QR Text</h2>
    <textarea id="qrText" placeholder="Example: KONARAK|STALL|WAR144"></textarea>
    <button class="secondary" onclick="decodeText()">Decode Text</button>
  </div>

  <!-- OUTPUT -->
  <div class="card">
    <h2>Decoded Result</h2>
    <div id="result" class="output">No data decoded yet.</div>
  </div>

</div>

<footer>
  Exact Text QR Decoder • Works without URL
</footer>

<script>
const video = document.getElementById("video");
const canvas = document.createElement("canvas");
const ctx = canvas.getContext("2d");

function startScan(){
  navigator.mediaDevices.getUserMedia({ video:{ facingMode:"environment" } })
    .then(stream=>{
      video.srcObject = stream;
      requestAnimationFrame(scanFrame);
    })
    .catch(()=>{
      alert("Camera access denied");
    });
}

function scanFrame(){
  if(video.readyState === video.HAVE_ENOUGH_DATA){
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    ctx.drawImage(video,0,0,canvas.width,canvas.height);
    const imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
    const qr = jsQR(imageData.data, canvas.width, canvas.height);
    if(qr){
      document.getElementById("qrText").value = qr.data;
      decodeText();
      stopCamera();
      return;
    }
  }
  requestAnimationFrame(scanFrame);
}

function stopCamera(){
  if(video.srcObject){
    video.srcObject.getTracks().forEach(t=>t.stop());
    video.srcObject = null;
  }
}

function decodeText(){
  const text = document.getElementById("qrText").value.trim();
  const result = document.getElementById("result");

  if(!text){
    result.innerHTML = `<div class="error">No text provided</div>`;
    return;
  }

  // Expected format: ORG|TYPE|CODE
  const parts = text.split("|");

  if(parts.length < 3){
    result.innerHTML = `<div class="error">Invalid QR text format</div>`;
    return;
  }

  const org = parts[0];
  const type = parts[1];
  const code = parts[2];

  /* SAMPLE DATA LOOKUP (Replace later with DB / Sheet) */
  const database = {
    "WAR144":{
      name:"Konarak – WAR144",
      rating:"4.5 / 5",
      hygiene:"9 / 10",
      audit:"12-Dec-2025",
      status:"APPROVED",
      remarks:"Gloves mandatory"
    }
  };

  if(!database[code]){
    result.innerHTML = `<div class="error">No record found for code: ${code}</div>`;
    return;
  }

  const d = database[code];

  result.innerHTML = `
    <div class="success">Decoded Successfully</div>
    <div class="row"><span class="label">Organization:</span> <span class="value">${org}</span></div>
    <div class="row"><span class="label">Type:</span> <span class="value">${type}</span></div>
    <div class="row"><span class="label">Code:</span> <span class="value">${code}</span></div>
    <hr>
    <div class="row"><span class="label">Name:</span> <span class="value">${d.name}</span></div>
    <div class="row"><span class="label">Rating:</span> <span class="value">${d.rating}</span></div>
    <div class="row"><span class="label">Hygiene:</span> <span class="value">${d.hygiene}</span></div>
    <div class="row"><span class="label">Last Audit:</span> <span class="value">${d.audit}</span></div>
    <div class="row"><span class="label">Status:</span> <span class="value">${d.status}</span></div>
    <div class="row"><span class="label">Remarks:</span> <span class="value">${d.remarks}</span></div>
  `;
}
</script>

</body>
</html>
