<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Konarak — Stall Audit (Final)</title>

<!-- CDN libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrious/dist/qrious.min.js"></script>

<style>
:root{
  --bg1:linear-gradient(135deg,#eef2f3,#d9e4f5);
  --card:#ffffff;
  --shadow:0 10px 30px rgba(2,6,23,0.12);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  background:var(--bg1);
  color:#0b1220;
}
.header{
  height:64px;
  background:#0b1220;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 20px;
}
.container{
  max-width:1200px;
  margin:22px auto;
  padding:0 18px;
}
.location-card{
  background:white;
  padding:12px;
  border-radius:10px;
  display:flex;
  gap:10px;
  align-items:center;
  box-shadow:var(--shadow);
}
.location-card input{
  padding:8px 10px;
  border-radius:8px;
  border:1px solid #e6eefc;
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:14px;
  margin-top:16px;
}
.qcard{
  background:white;
  padding:14px;
  border-radius:12px;
  box-shadow:0 10px 20px rgba(0,0,0,0.06);
}
select.form-control{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:1px solid #eef3fb;
  font-size:14px;
}
.summary-panel{
  display:flex;
  gap:12px;
  background:white;
  padding:12px;
  border-radius:10px;
  margin-top:16px;
  box-shadow:var(--shadow);
  flex-wrap:wrap;
}
.summary-item .num{
  font-size:16px;
  font-weight:700;
}
</style>
</head>

<body>

<div class="header">
  <div>Konarak — Stall Audit</div>
</div>

<div class="container">

  <div class="location-card">
    <input id="building" placeholder="Building">
    <input id="floor" placeholder="Floor">
    <input id="counter" placeholder="Counter / Stall">
    <input type="date" id="date">
  </div>

  <div class="grid" id="questionsGrid"></div>

  <div class="summary-panel">
    <div>
      Total Score
      <div class="summary-item"><div class="num" id="totalScore">0 / 130</div></div>
    </div>
    <div>
      Percentage
      <div class="summary-item"><div class="num" id="percentageDisplay">0%</div></div>
    </div>
    <div>
      Rating
      <div id="ratingStars"></div>
      <div id="ratingValue">0 / 5</div>
    </div>
  </div>

</div>

<script>
/* ================= QUESTIONS (13 × 10 = 130) ================= */
const QUESTIONS = [
  { key:'sales_report', text:'Daily sales report submitted?' },
  { key:'weekly_checklist', text:'Weekly checklist submitted?' },
  { key:'feedback_report', text:'Daily feedback report submitted?' },
  { key:'breakfast_on_time', text:'Breakfast arranged on time?' },
  { key:'lunch_on_time', text:'Lunch arranged on time?' },
  { key:'dinner_on_time', text:'Dinner arranged on time?' },
  { key:'temp_photo', text:'Food temperature measured & photo posted?' },
  { key:'staff_behaviour', text:'Staff behaviour is good?' },
  { key:'staff_hygiene', text:'Staff hygiene is good?' },
  { key:'stall_clean', text:'Stall is clean?' },
  { key:'food_complaint', text:'Food complaints?' },
  { key:'cbre_complaint', text:'CBRE complaints?' },
  { key:'cognizant_complaint', text:'Cognizant complaints?' }
];
const MAX_SCORE = QUESTIONS.length * 10;

/* ===== DOM REFERENCES (FIX) ===== */
let questionsGrid, totalScoreEl, percentageDisplayEl, ratingStarsEl, ratingValueEl;

/* ================= RENDER QUESTIONS ================= */
function renderQuestionCards(){
  questionsGrid.innerHTML = "";
  QUESTIONS.forEach(q=>{
    let opts="";
    for(let i=0;i<=10;i++) opts+=`<option value="${i}">${i}</option>`;
    const div=document.createElement("div");
    div.className="qcard";
    div.innerHTML=`
      <div style="font-weight:600">${q.text}</div>
      <select class="form-control" data-key="${q.key}">
        ${opts}
      </select>
    `;
    questionsGrid.appendChild(div);
  });
  document.querySelectorAll(".form-control")
    .forEach(s=>s.addEventListener("change", computeAndRenderScore));
}

/* ================= SCORING ================= */
function computeAndRenderScore(){
  let total=0;
  QUESTIONS.forEach(q=>{
    const sel=document.querySelector(\`select[data-key="\${q.key}"]\`);
    total+=Number(sel.value||0);
  });

  const percent=(total/MAX_SCORE)*100;
  const rating=(percent/100)*5;

  totalScoreEl.textContent=\`\${total} / \${MAX_SCORE}\`;
  percentageDisplayEl.textContent=\`\${percent.toFixed(1)}%\`;
  ratingValueEl.textContent=\`\${rating.toFixed(1)} / 5\`;

  ratingStarsEl.innerHTML="";
  const full=Math.floor(rating), half=(rating-full)>=0.5;
  for(let i=0;i<5;i++){
    if(i<full) ratingStarsEl.innerHTML+="★";
    else if(i===full && half) ratingStarsEl.innerHTML+="★";
    else ratingStarsEl.innerHTML+="☆";
  }
}

/* ================= INIT ================= */
document.addEventListener("DOMContentLoaded",()=>{
  questionsGrid=document.getElementById("questionsGrid");
  totalScoreEl=document.getElementById("totalScore");
  percentageDisplayEl=document.getElementById("percentageDisplay");
  ratingStarsEl=document.getElementById("ratingStars");
  ratingValueEl=document.getElementById("ratingValue");

  renderQuestionCards();
  document.querySelectorAll(".form-control").forEach(s=>s.value=0);
  date.value=new Date().toISOString().slice(0,10);
  computeAndRenderScore();
});
</script>

</body>
</html>
